<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Keyboard scancodes: Ordinary PC keyboards</TITLE>
 <LINK HREF="scancodes-2.html" REL=next>

 <LINK HREF="scancodes.html#toc1" REL=contents>
</HEAD>
<BODY>
<A HREF="scancodes-2.html">Next</A>
Previous
<A HREF="scancodes.html#toc1">Contents</A>
<HR>
<H2><A NAME="s1">1. Ordinary PC keyboards</A></H2>

<P>The data from a keyboard comes mainly in the form of scancodes,
produced by key presses or used in the protocol with the computer.
(Different codes are used by the keyboard firmware internally,
and there also exist several
<A HREF="#scancode_modes">sets of scancodes</A>. Here, for the
time being, we only give the default codes - those from scancode set 2.)
Each key press and key release produces between 0 and 6 scancodes.
<P>
<H2><A NAME="ss1.1">1.1 Key release</A>
</H2>

<P>Below I'll only mention the scancode for key press (`make').
The scancode for key release (`break') is obtained from it
by setting the high order bit (adding 0x80 = 128).
Thus, Esc press produces scancode <B>01</B>, Esc release
scancode <B>81</B> (hex).
For sequences things are similar: Keypad-/ gives <B>e0</B> <B>35</B>
when pressed, <B>e0</B> <B>b5</B> when released. Most keyboards will
repeat the make code (key down code) when the key repeats. Some will also
fake Shift down and Shift up events during the repeat.
<P>The keys PrtSc/SysRq and Pause/Break are special.
The former produces scancode <B>e0</B> <B>2a</B> <B>e0</B> <B>37</B>
when no modifier key is pressed simultaneously, <B>e0</B> <B>37</B>
together with Shift or Ctrl, but <B>54</B> together with (left or right) Alt.
The latter produces scancode sequence
<B>e1</B> <B>1d</B> <B>45</B> <B>e1</B> <B>9d</B> <B>c5</B>
when pressed (without modifier) and nothing at all upon release.
However, together with (left or right) Ctrl, one gets
<B>e0</B> <B>46</B> <B>e0</B> <B>c6</B>,
and again nothing at release. It does not repeat.
<P>
<P>
<H2><A NAME="ss1.2">1.2 Protocol scancodes</A>
</H2>

<P>Most scancodes indicate a key press or release.
Some are used in the communication protocol.
<P><B>00</B> (Keyboard buffer overflow or parity error)
<P><B>aa</B> (BAT [Basic Assurance Test] OK)
<P><B>ee</B> (Result of echo command)
<P><B>f1</B> (Some keyboards, as reply to command <B>a4</B>:
Password not installed)
<P><B>fa</B> (Ack)
<P><B>fc</B> (BAT error or Mouse transmit error)
<P><B>fe</B> (Keyboard fails to ack, please resend)
<P><B>ff</B> (Keyboard parity error)
<P>
<H2><A NAME="ss1.3">1.3 Escape scancodes</A>
</H2>

<P>The codes <B>e0</B> and <B>e1</B> introduce scancode sequences,
and are not usually used as isolated scancodes themselves
(but see 
<A HREF="scancodes-2.html#e0_as_key">below</A>).
<P>This, and the above, means that scancodes
<B>00</B>, <B>60</B>, <B>61</B>, <B>6e</B>, <B>71</B>,
<B>7a</B>, <B>7c</B>, <B>7e</B>, <B>7f</B>
are unavailable to signify key presses (on a default keyboard;
we'll see keyboards that actually use scancode <B>60</B>).
<P>Also other prefixes occur, see 
<A HREF="scancodes-2.html#prefix_80">below</A>.
<P>
<H2><A NAME="ss1.4">1.4 Ordinary scancodes</A>
</H2>

<P>The scancodes in scancode set 2 are given in hex.
Between parentheses the keycap on a US keyboard.
The scancodes are given in order, grouped according
to groups of keys that are usually found next to each other.
<P><B>00</B> is normally an error code
<P><B>01</B> (Esc)
<P><B>02</B> (1!), <B>03</B> (2@), <B>04</B> (3#), <B>05</B> (4$),
<B>06</B> (5%E), <B>07</B> (6^), <B>08</B> (7&amp;),
<B>09</B> (8*), <B>0a</B> (9(), <B>0b</B> (0)), <B>0c</B> (-_),
<B>0d</B> (=+), <B>0e</B> (Backspace)
<P><B>0f</B> (Tab), <B>10</B> (Q), <B>11</B> (W), <B>12</B> (E),
<B>13</B> (R), <B>14</B> (T), <B>15</B> (Y),
<B>16</B> (U), <B>17</B> (I), <B>18</B> (O),
<B>19</B> (P), <B>1a</B> ([{), <B>1b</B> (]})
<P><B>1c</B> (Enter)
<P><B>1d</B> (LCtrl)
<P><B>1e</B> (A), <B>1f</B> (S), <B>20</B> (D), <B>21</B> (F),
<B>22</B> (G), <B>23</B> (H), <B>24</B> (J), <B>25</B> (K),
<B>26</B> (L), <B>27</B> (;:), <B>28</B> ('")
<P><B>29</B> (`~)
<P><B>2a</B> (LShift)
<P><B>2b</B> (\|), on a 102-key keyboard
<P><B>2c</B> (Z), <B>2d</B> (X), <B>2e</B> (C), <B>2f</B> (V),
<B>30</B> (B), <B>31</B> (N), <B>32</B> (M), <B>33</B> (,&lt;),
<B>34</B> (.&gt;), <B>35</B> (/?), <B>36</B> (RShift)
<P><B>37</B> (Keypad-*) or (*/PrtScn) on a 83/84-key keyboard
<P><B>38</B> (LAlt), <B>39</B> (Space bar),
<P><B>3a</B> (CapsLock)
<P><B>3b</B> (F1), <B>3c</B> (F2), <B>3d</B> (F3), <B>3e</B> (F4),
<B>3f</B> (F5), <B>40</B> (F6), <B>41</B> (F7),
<B>42</B> (F8), <B>43</B> (F9), <B>44</B> (F10)
<P><B>45</B> (NumLock)
<P><B>46</B> (ScrollLock)
<P><B>47</B> (Keypad-7/Home), <B>48</B> (Keypad-8/Up),
<B>49</B> (Keypad-9/PgUp)
<P><B>4a</B> (Keypad--)
<P><B>4b</B> (Keypad-4/Left), <B>4c</B> (Keypad-5),
<B>4d</B> (Keypad-6/Right), <B>4e</B> (Keypad-+)
<P><B>4f</B> (Keypad-1/End), <B>50</B> (Keypad-2/Down),
<B>51</B> (Keypad-3/PgDn)
<P><B>52</B> (Keypad-0/Ins), <B>53</B> (Keypad-./Del)
<P><B>54</B> (Alt-SysRq) on a 84+ key keyboard
<P><B>55</B> is less common; occurs as PF1 on a Focus 9000 keyboard,
and as FN on an IBM ThinkPad.
<P><B>56</B> mostly on non-US keyboards. It is an unlabelled key
next to the space bar on a Toshiba notebook.
<P><B>57</B> (F11), <B>58</B> (F12) both on a 101+ key keyboard
<P><B>59</B>-<B>5a</B>-...-<B>7f</B> are less common.
Scancodes <B>59</B>-<B>5c</B> occur on the RC930 keyboard.
X calls <B>5d</B> `KEY_Begin'.
Scancodes <B>55</B>, <B>6d</B>, <B>6f</B>, <B>73</B>, <B>74</B>,
<B>77</B>, <B>78</B>, <B>79</B>, <B>7a</B>, <B>7b</B>,
<B>7c</B>, <B>7e</B> occur on the Focus 9000 keyboard.
Scancodes <B>73</B>, <B>7d</B> occur on a Japanese 86/106 keyboard.
<P>
<P>
<H2><A NAME="ss1.5">1.5 Escaped scancodes</A>
</H2>

<P>Apart from the Pause/Break key that has an escaped sequence starting
with <B>e1</B>, the escape used is <B>e0</B>. Often, the codes
are chosen in such a way that something meaningful happens when
the receiver just discards the <B>e0</B>.
<P><B>e0</B> <B>1c</B> (Keypad Enter) - <B>1c</B> (Enter)
<P><B>e0</B> <B>1d</B> (RCtrl) - <B>1d</B> (LCtrl)
<P><B>e0</B> <B>2a</B> (fake LShift) - <B>2a</B> (LShift)
<P><B>e0</B> <B>35</B> (Keypad-/) - <B>35</B> (/?)
<P><B>e0</B> <B>36</B> (fake RShift) - <B>36</B> (RShift)
<P><B>e0</B> <B>37</B> (Ctrl-PrtScn) - <B>37</B> (*/PrtScn)
<P><B>e0</B> <B>38</B> (RAlt) - <B>38</B> (LAlt)
<P><B>e0</B> <B>46</B> (Ctrl-Break) - <B>46</B> (ScrollLock)
<P><B>e0</B> <B>47</B> (Grey Home) - <B>47</B> (Keypad-7/Home)
<P><B>e0</B> <B>48</B> (Grey Up) - <B>48</B> (Keypad-8/UpArrow)
<P><B>e0</B> <B>49</B> (Grey PgUp) - <B>49</B> (Keypad-9/PgUp)
<P><B>e0</B> <B>4b</B> (Grey Left) - <B>4b</B> (Keypad-4/Left)
<P><B>e0</B> <B>4d</B> (Grey Right) - <B>4d</B> (Keypad-6/Right)
<P><B>e0</B> <B>4f</B> (Grey End) - <B>4f</B> (Keypad-1/End)
<P><B>e0</B> <B>50</B> (Grey Down) - <B>50</B> (Keypad-2/DownArrow)
<P><B>e0</B> <B>51</B> (Grey PgDn) - <B>51</B> (Keypad-3/PgDn)
<P><B>e0</B> <B>52</B> (Grey Insert) - <B>52</B> (Keypad-0/Ins)
<P><B>e0</B> <B>53</B> (Grey Delete) - <B>53</B> (Keypad-./Del)
<P>These escaped scancodes occur only on 101+ key keyboards.
<P>
<H2><A NAME="ss1.6">1.6 Fake shifts</A>
</H2>

<P>The ten grey keys Insert, Home, PgUp, Delete, End, PgDn,
Up, Left, Down, Right are supposed to function regardless
of the state of Shift and NumLock keys. But for an old AT keyboard
the keypad keys would produce digits when Numlock was on or Shift
was down. Therefore, in order to fool old programs,
fake scancodes are sent: when LShift is down, and Insert is
pressed, <B>e0</B> <B>aa</B> <B>e0</B> <B>52</B> is sent;
upon release of Insert <B>e0</B> <B>d2</B> <B>e0</B> <B>2a</B>
is sent. In other words, a fake LShift-up and
fake LShift-down are inserted.
<P>If the Shift key is released earlier than the repeated key,
then a real Shift-up code occurs (without preceding fake Shift-down)
so that a program ignoring <B>e0</B> would see one more Shift-up
than Shift-down.
<P>When NumLock is on, no fake Shifts are sent when Shift was down,
but fake Shifts are sent when Shift was not down. Thus,
with Numlock, if Insert is pressed,
<B>e0</B> <B>2a</B> <B>e0</B> <B>52</B> is sent
and upon release <B>e0</B> <B>d2</B> <B>e0</B> <B>aa</B> is sent.
The keyboard maintains a private NumLock mode, toggled when
NumLock is pressed, and set when the NumLock LED is set.
<P>In the same way, when Shift is down, the Grey-/ key produces
fake Shift-up and fake Shift-down sequences. However, it does
not react to the state of NumLock. The purpose of course is to
fool programs that identify Grey-/ with ordinary /, so that they
don't treat Shift-Grey-/ like Shift-/, i.e., ?.
<P>On a Toshiba notebook, the three Windows keys are treated like
the group of ten keys mentioned, and get fake shifts when
(left or right) Shift is down. Thet do not react to NumLock.
<P>
<H2><A NAME="ss1.7">1.7 Turbo Mode</A>
</H2>

<P>On some motherboards the LCtrl-LAlt-GreyPlus and LCtrl-LAlt-GreyMinus
switch Turbo mode on/off, respectively. For these, the motherboard
may generate the same scancode sequence when the Turbo button is
pushed: Turbo Switch (High->Low):
<B>1d</B> <B>38</B> <B>4a</B> <B>ce</B> <B>b8</B> <B>9d</B>
and Turbo Switch (Low->High):
<B>1d</B> <B>38</B> <B>4e</B> <B>ce</B> <B>b8</B> <B>9d</B>.
<P>Other peculiar combinations in this style include
LCtrl-LAlt-LShift-GreyMinus to turn off system cache.
<P>Thio Yu Jin &lt;jin@singmail.com&gt; complains that on his Toshiba 4010CDS
the Ctrl-Alt-Shift-T key combination brings up the Toshiba user manual.
(04 Mar 1999 - not April 1.)
<P>
<P>
<H2><A NAME="scancode_modes"></A> <A NAME="ss1.8">1.8 Scancode modes</A>
</H2>

<P>The usual PC keyboards are capable of producing three
sets of scancodes. Writing 0xf0 followed by 1, 2 or 3 to port
0x60 will put the keyboard in scancode mode 1, 2 or 3. Writing
0xf0 followed by 0 queries the mode, resulting in a scancode
byte 0x43, 0x41 or 0x3f from the keyboard.
<P>Scancode mode 2 is the default. In this mode, a key press
usually produces a value <I>s</I> in the range 0x01-0x5f and the
corresponding key release produces <I>s</I>+0x80. In scancode
mode 3, the only key releases that produce a scan code are of
either Shift key, or of the left Ctrl and Alt keys; for all
other keys only the key presses are noted. The produced
scancodes are mostly equal to those for scancode mode 2.
<P>In scancode mode 1 most key releases produce the same values as
in scancode mode 2, but for key presses there are entirely
different, unrelated values. The details are somewhat messy.
<P>
<HR>
<A HREF="scancodes-2.html">Next</A>
Previous
<A HREF="scancodes.html#toc1">Contents</A>
</BODY>
</HTML>
